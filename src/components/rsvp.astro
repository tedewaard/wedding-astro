---
//const {} = Astro.props;

import closeIcon from '../images/close_icon.png';

import {findPerson} from '../googleAPI.js';

let person = "";

if (Astro.request.method === "POST") {
    try {
        const data = await Astro.request.formData();
        const name = data.get("name");
        const song = data.get("song");
        let testData = await findPerson(name);
        person = testData[0].Name;
        console.log(name);
        console.log(song);
    } catch (error) {
        if (error instanceof Error) {
            console.error(error.message);
        }
    }
}

---

<script>
	let rsvp_button = document.getElementById('rsvp');
    let vis = document.getElementById('vis');
    let close = document.getElementById('close');
	rsvp_button.onclick = function() {
        if (vis.className == 'hidden'){
            vis.setAttribute('class', 'fixed top-0 left-0 w-full h-full z-10 bg-black/40 ');
        } else {
            vis.setAttribute('class', 'hidden');
        }
	};
    close.addEventListener('click', function (event) {
        if (vis.className == 'hidden'){
            vis.setAttribute('class', 'fixed top-0 left-0 w-full h-full z-10 bg-black/40 ');
        } else {
            vis.setAttribute('class', 'hidden');
        }
    });

</script>

<div id="vis" class="hidden">
<div class="relative border-black rounded-3xl border-4 w-3/12 mx-auto bg-white z-20 mt-40">
    <div id="close" class="absolute top-2 right-2"><img src={closeIcon} width="20" height="20"></div>
	<h2 class="text-center underline text-2xl font-bold">RSVP</h2>
	<p class="text-center font-bold">October 19, 2024</p>	
	<p class="text-center text-sm font-bold">4PM - 11PM</p>	
    <form method="POST" class="">
        <div class="flex mx-auto w-4/5 my-4">
            <div class="mr-4 whitespace-nowrap">
                <label class="font-bold" for="name">Name:</label><br>
                <label class="font-bold" for="song">Song Request:</label>
            </div>
            <div class="min-w-0">
                <input class="h-6 max-w-full border rounded-lg border-black mb-1" type="text" id="name" name="name" required><br>
                <input class="h-6 max-w-full border rounded-lg border-black" type="text" id="song" name="song"><br>
            </div>
        </div>
        <div class="flex">
            <input id="submit" class="mb-4 mx-auto w-1/3 text-center border-black border rounded-lg" type="submit" value="Submit">
        </div>
        <div>
            {person}
        </div>
    </form>
</div>
</div>